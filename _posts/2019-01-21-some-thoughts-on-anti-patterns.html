---
layout: post
title: "Some thoughts on anti-patterns"
description: "What's an anti-pattern? Are there rules to identify them, or is it just name-calling? Before I use the term, I try to apply some rules of thumb."
date: 2019-01-21 7:30 UTC
tags: [Design Patterns]
---
{% include JB/setup %}

<div id="post">
	<p>
		<em>{{ page.description }}</em>
	</p>
	<p>
		It takes time to write a book. Months, even years. It took me two years to write the first edition of <a href="http://amzn.to/12p90MG">Dependency Injection in .NET</a>. The <a href="https://amzn.to/2TE8tJx">second edition of Dependency Injection in .NET</a> is also the result of much work; not so much by me, but by my co-author <a href="http://www.cuttingedge.it/blogs/steven">Steven van Deursen</a>.
	</p>
	<p>
		When you write a book single-handedly, you can be as opinionated as you'd like. When you have a co-author, regardless of how much you think alike, there's bound to be some disagreements. Steven and I agreed about most of the changes we'd like to make to the second edition, but each of us had to yield or compromise a few times.
	</p>
	<p>
		An interesting experience has been that on more than one occasion where I've reluctantly had to yield to Steven, over the time, I've come to appreciate his position. Two minds think better than one.
	</p>
	<h3 id="6497bdfd47db433c92a6ec4fabfd4e92">
		Ambient Context <a href="#6497bdfd47db433c92a6ec4fabfd4e92" title="permalink">#</a>
	</h3>
	<p>
		One of the changes that Steven wanted to make was that he wanted to change the status of the <em>Ambient Context</em> pattern to an anti-pattern. While I never use that pattern myself, I included it in the first edition in the spirit of the original <a href="http://amzn.to/XBYukB">Design Patterns</a> book. The <em>Gang of Four</em> made it clear that the patterns they'd described weren't invented, but rather discovered:
		<blockquote>
			<p>
				"We have included only designs that have been applied more than once in different systems."
			</p>
			<footer><cite>Gamma et al, <em>Design Patterns</em>, 1994, p. 2</cite></footer>
		</blockquote>
		The spirit, as I understand it, is to identify solutions that already exist, and catalogue them. When I wrote the first edition of my book, I tried to do that as well.
	</p>
	<p>
		I'd noticed what I eventually named the <em>Ambient Context</em> pattern several places in the .NET Base Class Library. Some of those APIs are still around today. <a href="https://docs.microsoft.com/dotnet/api/system.threading.thread.currentprincipal">Thread.CurrentPrincipal</a>, <a href="https://docs.microsoft.com/dotnet/api/system.globalization.cultureinfo.currentculture">CultureInfo.CurrentCulture</a>, <a href="https://en.wikipedia.org/wiki/Thread-local_storage">thread-local storage</a>, <a href="https://docs.microsoft.com/dotnet/api/system.web.httpcontext.current">HttpContext.Current</a>, and so on.
	</p>
	<p>
		None of these really have anything to do with Dependency Injection (DI), but people sometimes attempt to use them to solve problems similar to the problems that DI addresses. For that reason, and because the pattern was so prevalent, I included it in the book - as a pattern, not an anti-pattern.
	</p>
	<p>
		Steven wanted to make it an anti-pattern, and I conceded. I wasn't sure I was ready to explicitly call it out as an anti-pattern, but I agreed to the change. I'm becoming increasingly happy that Steven talked me into it.
	</p>
	<h3 id="08fbf0fd59154a57bbba936128f6c60e">
		Pareto efficiency <a href="#08fbf0fd59154a57bbba936128f6c60e" title="permalink">#</a>
	</h3>
	<p>
		I've heard said of me that I'm one of those people who call everything I don't like an anti-pattern. I don't think that's true.
	</p>
	<p>
		I think people's perception of me is skewed because even today, the most visited page (my greatest hit, if you will) is an article called <a href="http://blog.ploeh.dk/2010/02/03/ServiceLocatorisanAnti-Pattern">Service Locator is an Anti-Pattern</a>. (It concerns me a bit that an article from 2010 seems to be my crowning achievement. I hope I haven't peaked yet, but the numbers tell a different tale.)
	</p>
	<p>
		While I've used the term <em>anti-pattern</em> in other connections, I prefer to be conservative with my use of the word. I tend to use it only when I feel confident that something is, indeed, an anti-pattern.
	</p>
	<p>
		What's an anti-pattern? <a href="https://amzn.to/2VHDX3m">AntiPatterns</a> defines it like this:
		<blockquote>
			<p>
				"An AntiPattern is a literary form that describes a commonly occurring solution to a problem that generates decidedly negative consequences."
			</p>
			<footer><cite>Brown et al, <em>AntiPatterns</em>, 1998, p. 7</cite></footer>
		</blockquote>
		As definitions go, it's quite amphibolous. Is it the problem that generates negative consequences? Hardly. In the context, it's clear that it's the solution that causes problems. In any case, just because it's in a book doesn't necessarily make it right, but I find it a good start.
	</p>
	<p>
		I think that the phrase <em>decidedly negative consequences</em> is key. Most solutions come with <em>some</em> disadvantages, but in order for a 'solution' to be an anti-pattern, the disadvantages must clearly outweigh any advantages produced.
	</p>
	<p>
		I usually look at it another way. If I can solve the problem in a different way that generates at least as many advantages, but fewer disadvantages, then the first 'solution' might be an anti-pattern. This way of viewing the problem may stem from my background in economics. In that perspective, an anti-pattern simply isn't <a href="https://en.wikipedia.org/wiki/Pareto_efficiency">Pareto optimal</a>.
	</p>
	<h3 id="eb04af30ae5b40529fda1588525aee6d">
		Falsifiability <a href="#eb04af30ae5b40529fda1588525aee6d" title="permalink">#</a>
	</h3>
	<p>
		Another rule of thumb I employ to determine whether a solution could be an anti-pattern is <a href="https://en.wikipedia.org/wiki/Karl_Popper">Popper</a>'s concept of <a href="https://en.wikipedia.org/wiki/Falsifiability">falsifiability</a>. As a continuation of the Pareto efficiency perspective, an anti-pattern is a 'solution' that you can improve without any (significant) trade-offs.
	</p>
	<p>
		That turns claims about anti-patterns into falsifiable statements, which I consider is the most intellectually honest way to go about claiming that things are bad.
	</p>
	<p>
		Take, for example, the claim that <em>Service Locator is an anti-pattern</em>. In light of Pareto efficiency, that's a falsifiable claim. All you have to do to prove me wrong is to present a situation where Service Locator solves a problem, and I can't come up with a better solution.
	</p>
	<p>
		I made the claim about Service Locator in 2010, and so far, no one has been able to present such a situation, even though several have tried. I'm fairly confident making that claim.
	</p>
	<p>
		This way of looking at the term anti-pattern, however, makes me wary of declaiming solutions anti-patterns just because I don't like them. Could there be a counter-argument, some niche scenario, where the pattern actually couldn't be improved without trade-offs?
	</p>
	<p>
		I didn't take it lightly when Steven suggested making Ambient Context an anti-pattern.
	</p>
	<h3 id="e027fe12038c4160a3be19bce065cd74">
		Preliminary status <a href="#e027fe12038c4160a3be19bce065cd74" title="permalink">#</a>
	</h3>
	<p>
		I've had some time to think about Ambient Context since I had the (civil) discussion with Steven. The more I think about it, the more I think that he's right; that Ambient Context really <em>is</em> an anti-pattern.
	</p>
	<p>
		I never use that pattern myself, so it's clear to me that for all the situations that I typically encounter, there's always better solutions, with no significant trade-offs.
	</p>
	<p>
		The question is: could there be some niche scenario that I'm not aware of, where Ambient Context is a bona fide good solution?
	</p>
	<p>
		The more I think about this, the more I'm beginning to believe that there isn't. It remains to be seen, though. It remains to be falsified.
	</p>
	<h3 id="ed7478fa76324922a5543964e9c8c48e">
		Summary <a href="#ed7478fa76324922a5543964e9c8c48e" title="permalink">#</a>
	</h3>
	<p>
		I'm so happy that Steven van Deursen agreed to co-author the second edition of <em>Dependency Injection in .NET</em> with me. The few areas where we've disagreed, I've ultimately come around to agree with him. He's truly taken a good book and made it better.
	</p>
	<p>
		One of the changes is that Ambient Context is now classified as an anti-pattern. Originally, I wasn't sure that this was the correct thing to do, but I've since changed my mind. I do think that Ambient Context belongs in the anti-patterns chapter.
	</p>
	<p>
		I could be wrong, though. I was before.
	</p>
</div>